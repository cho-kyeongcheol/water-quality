{% extends "backend/layout/base.html" %}

{% block content %}
    <div class="container pt-25 debug">
        <div class="pd-20 debug">
            <div class="title">new_map</div>
            <button id="allMenu" onclick="changeMarker('all')">ALL</button>
            <button id="coffeeMenu" onclick="changeMarker('coffee')">AAAA</button>
            <button id="storeMenu" onclick="changeMarker('store')">BBBB</button>
            <button id="carparkMenu" onclick="changeMarker('carpark')">CCCC</button>
            <!--
            <div class="category">
                <ul>
                    <li id="coffeeMenu" onclick="changeMarker('coffee')">
                        <span class="ico_comm black"></span>
                        ALL
                    </li>
                    <li id="coffeeMenu" onclick="changeMarker('coffee')">
                        <span class="ico_comm ico_coffee"></span>
                        커피숍
                    </li>
                    <li  onclick="changeMarker('store')">
                        <span class="ico_comm ico_store"></span>
                        편의점
                    </li>
                    <li id="carparkMenu" onclick="changeMarker('carpark')">
                        <span class="ico_comm ico_carpark"></span>
                        주차장
                    </li>
                </ul>
                -->
        </div>
        <div id="map" style="width:100%;height:500px;"></div>
        <!-- 지도 위에 표시될 마커 카테고리 -->

    </div>
    </div>
{% endblock %}

{% block javascript %}
    <script type="text/javascript"
            src="//dapi.kakao.com/v2/maps/sdk.js?appkey=411014b49760133574f1c56e4c7f9bd1&libraries=services,clusterer,drawing"></script>
    <script type="text/javascript"
            src="//dapi.kakao.com/v2/maps/sdk.js?appkey=411014b49760133574f1c56e4c7f9bd1"></script>
    <script>
        var container = document.getElementById('map'); //지도를 담을 영역의 DOM 레퍼런스
        var options = { //지도를 생성할 때 필요한 기본 옵션
            center: new kakao.maps.LatLng(36.5, 127.5), //지도의 중심좌표.
            level: 13//지도의 레벨(확대, 축소 정도)
        };

        var map = new kakao.maps.Map(container, options); //지도 생성 및 객체 리턴
        map.addOverlayMapTypeId(kakao.maps.MapTypeId.TERRAIN);

        // 커피숍 마커가 표시될 좌표 배열입니다
        var coffeePositions = [
            new kakao.maps.LatLng(37.877653, 127.678647),
            new kakao.maps.LatLng(38.032802, 127.077585),
            new kakao.maps.LatLng(37.442547, 127.310526),
            new kakao.maps.LatLng(37.320053, 127.613025)
        ];

        // 편의점 마커가 표시될 좌표 배열입니다
        var storePositions = [
            new kakao.maps.LatLng(35.363586, 128.904788),
            new kakao.maps.LatLng(36.543947, 128.461752),
            new kakao.maps.LatLng(36.930161, 129.054875),
            new kakao.maps.LatLng(35.387538, 128.438374)
        ];

        // 주차장 마커가 표시될 좌표 배열입니다
        var carparkPositions = [
            new kakao.maps.LatLng(36.108051, 127.545148),
            new kakao.maps.LatLng(36.459901, 127.461732),
            new kakao.maps.LatLng(36.525191, 127.320098),
            new kakao.maps.LatLng(36.479886, 127.271225)
        ];


        var markerImageSrc = 'https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/category.png';  // 마커이미지의 주소입니다. 스프라이트 이미지 입니다
        coffeeMarkers = [], // 커피숍 마커 객체를 가지고 있을 배열입니다
        storeMarkers = [], // 편의점 마커 객체를 가지고 있을 배열입니다
        carparkMarkers = []; // 주차장 마커 객체를 가지고 있을 배열입니다


        createCoffeeMarkers(); // 커피숍 마커를 생성하고 커피숍 마커 배열에 추가합니다
        createStoreMarkers(); // 편의점 마커를 생성하고 편의점 마커 배열에 추가합니다
        createCarparkMarkers(); // 주차장 마커를 생성하고 주차장 마커 배열에 추가합니다

        changeMarker('all'); // 지도에 커피숍 마커가 보이도록 설정합니다


        // 마커이미지의 주소와, 크기, 옵션으로 마커 이미지를 생성하여 리턴하는 함수입니다
        function createMarkerImage(src, size, options) {
            var markerImage = new kakao.maps.MarkerImage(src, size, options);
            return markerImage;
        }

        // 좌표와 마커이미지를 받아 마커를 생성하여 리턴하는 함수입니다
        function createMarker(position, image) {
            var marker = new kakao.maps.Marker({
                position: position,
                image: image
            });

            return marker;
        }

        // 커피숍 마커를 생성하고 커피숍 마커 배열에 추가하는 함수입니다
        function createCoffeeMarkers() {

            for (var i = 0; i < coffeePositions.length; i++) {

                var imageSize = new kakao.maps.Size(22, 26),
                    imageOptions = {
                        spriteOrigin: new kakao.maps.Point(10, 0),
                        spriteSize: new kakao.maps.Size(36, 98)
                    };

                // 마커이미지와 마커를 생성합니다
                var markerImage = createMarkerImage(markerImageSrc, imageSize, imageOptions),
                    marker = createMarker(coffeePositions[i], markerImage);

                // 생성된 마커를 커피숍 마커 배열에 추가합니다
                coffeeMarkers.push(marker);
            }
        }

        // 커피숍 마커들의 지도 표시 여부를 설정하는 함수입니다
        function setCoffeeMarkers(map) {
            for (var i = 0; i < coffeeMarkers.length; i++) {
                coffeeMarkers[i].setMap(map);
            }
        }

        // 편의점 마커를 생성하고 편의점 마커 배열에 추가하는 함수입니다
        function createStoreMarkers() {
            for (var i = 0; i < storePositions.length; i++) {

                var imageSize = new kakao.maps.Size(22, 26),
                    imageOptions = {
                        spriteOrigin: new kakao.maps.Point(10, 36),
                        spriteSize: new kakao.maps.Size(36, 98)
                    };

                // 마커이미지와 마커를 생성합니다
                var markerImage = createMarkerImage(markerImageSrc, imageSize, imageOptions),
                    marker = createMarker(storePositions[i], markerImage);

                // 생성된 마커를 편의점 마커 배열에 추가합니다
                storeMarkers.push(marker);
            }
        }

        // 편의점 마커들의 지도 표시 여부를 설정하는 함수입니다
        function setStoreMarkers(map) {
            for (var i = 0; i < storeMarkers.length; i++) {
                storeMarkers[i].setMap(map);
            }
        }

        // 주차장 마커를 생성하고 주차장 마커 배열에 추가하는 함수입니다
        function createCarparkMarkers() {
            for (var i = 0; i < carparkPositions.length; i++) {

                var imageSize = new kakao.maps.Size(22, 26),
                    imageOptions = {
                        spriteOrigin: new kakao.maps.Point(10, 72),
                        spriteSize: new kakao.maps.Size(36, 98)
                    };

                // 마커이미지와 마커를 생성합니다
                var markerImage = createMarkerImage(markerImageSrc, imageSize, imageOptions),
                    marker = createMarker(carparkPositions[i], markerImage);

                // 생성된 마커를 주차장 마커 배열에 추가합니다
                carparkMarkers.push(marker);
            }
        }

        // 주차장 마커들의 지도 표시 여부를 설정하는 함수입니다
        function setCarparkMarkers(map) {
            for (var i = 0; i < carparkMarkers.length; i++) {
                carparkMarkers[i].setMap(map);
            }
        }

        // 카테고리를 클릭했을 때 type에 따라 카테고리의 스타일과 지도에 표시되는 마커를 변경합니다
        function changeMarker(type) {

            var coffeeMenu = document.getElementById('coffeeMenu');
            var storeMenu = document.getElementById('storeMenu');
            var carparkMenu = document.getElementById('carparkMenu');
            if (type === 'all') {

                // 커피숍 카테고리를 선택된 스타일로 변경하고
                coffeeMenu.className = 'menu_selected';

                // 편의점과 주차장 카테고리는 선택되지 않은 스타일로 바꿉니다
                storeMenu.className = 'menu_selected';
                carparkMenu.className = 'menu_selected';

                // 커피숍 마커들만 지도에 표시하도록 설정합니다
                setCoffeeMarkers(map);
                setStoreMarkers(map);
                setCarparkMarkers(map);
            }
            // 커피숍 카테고리가 클릭됐을 때
            else if (type === 'coffee') {

                // 커피숍 카테고리를 선택된 스타일로 변경하고
                coffeeMenu.className = 'menu_selected';

                // 편의점과 주차장 카테고리는 선택되지 않은 스타일로 바꿉니다
                storeMenu.className = '';
                carparkMenu.className = '';

                // 커피숍 마커들만 지도에 표시하도록 설정합니다
                setCoffeeMarkers(map);
                setStoreMarkers(null);
                setCarparkMarkers(null);

            } else if (type === 'store') { // 편의점 카테고리가 클릭됐을 때

                // 편의점 카테고리를 선택된 스타일로 변경하고
                coffeeMenu.className = '';
                storeMenu.className = 'menu_selected';
                carparkMenu.className = '';

                // 편의점 마커들만 지도에 표시하도록 설정합니다
                setCoffeeMarkers(null);
                setStoreMarkers(map);
                setCarparkMarkers(null);

            } else if (type === 'carpark') { // 주차장 카테고리가 클릭됐을 때

                // 주차장 카테고리를 선택된 스타일로 변경하고
                coffeeMenu.className = '';
                storeMenu.className = '';
                carparkMenu.className = 'menu_selected';

                // 주차장 마커들만 지도에 표시하도록 설정합니다
                setCoffeeMarkers(null);
                setStoreMarkers(null);
                setCarparkMarkers(map);
            }
        }
    </script>
{% endblock %}